import{p as b,q as x,R as r,b7 as F,l as A,b as j,u as L,M as T,j as e,I as R,b8 as _}from"./index-BebHIGA7.js";import{e as D}from"./index-5aodUL1S.js";import{n as B,a as P,i as U,p as q,o as E}from"./MenuBar-C2yzXUo3.js";const H="_customToastWidth_454j7_1",K={customToastWidth:H},J=x.mixin({toast:!0,position:"top",showConfirmButton:!1,timer:1500,timerProgressBar:!0,customClass:{popup:K.customToastWidth},didOpen:c=>{c.onmouseenter=x.stopTimer,c.onmouseleave=x.resumeTimer}}),v=async({sessionId:c,accessToken:u,isLogin:a,setIsNotice:i,setIsPriceNotice:h,setIsOrderNotice:y})=>{const t={userId:c};if(a===!0)try{const l=await b.get("/api/user/alert",{params:t,headers:{Authorization:`Bearer ${u}`}});console.log("사용자 알림 데이터 : ",l.data.resultData);const d=l.data.resultData;i([...d]),d.length!==0&&J.fire({icon:"info",title:"새로운 알림이 도착했어요"})}catch(l){console.log(l)}else i([])},Q=()=>{var z;const[c,u]=r(F),[a,i]=r(B),[h,y]=r(A),[t,l]=j.useState({}),[d,f]=r(P),[g,k]=j.useState({}),[w,p]=j.useState(!1),I=L(),m=T(),N=window.sessionStorage.getItem("userId"),S=async s=>{console.log(s);const o={userId:N,orderId:s.orderId,orderUserId:s.orderUserId};try{const n=await b.get("/api/user/user-payment-member/my",{params:o,headers:{Authorization:`Bearer ${m}`}});console.log(n.data.resultData),k({...n.data.resultData,orderId:s.orderId})}catch(n){console.log(n)}},O=async()=>{const s={orderId:parseInt(g.orderId),userId:parseInt(N),approvalStatus:1};console.log("보낼 데이터 : ",s),f(!1);try{const o=await b.patch("/api/user/user-payment-member",s,{headers:{Authorization:`Bearer ${m}`}});console.log(o.data.resultData),p(!1),x.fire({title:"결제가 승인 되었습니다!",icon:"success",confirmButtonText:"확인",showConfirmButton:!0,allowOutsideClick:!1,customClass:{popup:"flex w-[80%]",title:"text-xl text-black"}}).then(n=>{n.isConfirmed&&(I("/user"),v({sessionId:N,accessToken:m,isLogin:h,setIsNotice:i}))})}catch(o){console.log(o)}},G=async()=>{const s={orderId:parseInt(g.orderId),userId:parseInt(N),approvalStatus:2};console.log("보낼 데이터 : ",s);try{const o=await b.patch("/api/user/user-payment-member",s,{headers:{Authorization:`Bearer ${m}`}});console.log("api 연결 성공 후 response : ",o.data.result),p(!1),x.fire({title:"결제가 거절되었습니다.",icon:"error",confirmButtonText:"확인",allowOutsideClick:!1}).then(n=>{n.isConfirmed&&(I("/user"),v({sessionId,accessToken:m,isLogin:h,setIsNotice:i}))})}catch(o){console.log(o)}},W=s=>{I(`/user/placetoorder/member/${s}`,{state:{orderId:s}}),u(s),f(!1)},$=s=>{I(`/user/placetoorder/request/${s}`)},M=s=>{switch(s.message){case"나한테 온 승인요청 메세지":C(s),S(s),p(!0);break;case"인원 선택 메세지":W(s.orderId);break;case"식권 생성 요청 메세지":$(s.orderId);break;default:console.warn("알 수 없는 알림 타입:",s.message)}},C=s=>{console.log("데이터 불러오기",s),l({...s})};return e.jsxs("div",{className:"absolute top-12 right-5 w-[80%] bg-white z-50 border-2 border-darkGray rounded-md pb-4 overflow-x-hidden over overflow-y-scroll scrollbar-hide",children:[e.jsx("div",{className:"p-5 font-semibold text-darkGray",children:"알림"}),e.jsxs("div",{className:"flex flex-col px-5 gap-5 font-medium text-nowrap",children:[(a==null?void 0:a.length)>0?a.map(s=>e.jsx("div",{onClick:()=>M(s),className:"flex w-full h-[10%]",children:s.message==="나한테 온 승인요청 메세지"?e.jsx(e.Fragment,{children:e.jsx("span",{className:"font-bold cursor-pointer",onClick:()=>C(s),children:s.message})}):s.message==="인원 선택 메세지"?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex gap-2 items-center cursor-pointer",children:[e.jsx("span",{className:"text-black text-xl",children:s.restaurantName}),e.jsx("span",{className:"text-darkGray",children:"인원 선택"})]})}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex gap-2 items-center cursor-pointer",children:[e.jsx("span",{className:"text-black text-xl",children:s.restaurantName}),e.jsx("span",{className:"text-darkGray",children:"식권 생성"})]})})},s.orderId)):e.jsx("span",{className:"text-darkGray tracking-wide",children:"새로운 알림이 없습니다"}),w?e.jsx("div",{className:"w-full h-dvh overflow-hidden fixed top-0 left-0 bg-darkGray bg-opacity-70 flex justify-center items-center text-center z-10",children:e.jsxs("div",{onClick:s=>s.stopPropagation(),className:"absolute top-40 left-1/6 w-[340px] h-[280px] z-50 bg-white border-2 border-darkGray rounded-lg border-opacity-30 overflow-x-hidden overflow-y-scroll scrollbar-hide",children:[e.jsx("div",{className:"relative flex w-full h-[20%]",children:e.jsxs("div",{className:"absolute top-0 left-0 flex w-full h-full justify-between items-center px-5 border-b-2 border-gray",children:[e.jsxs("span",{className:"font-medium text-2xl",children:[t==null?void 0:t.orderUserName,"님의 승인 요청"]}),e.jsx(R,{onClick:()=>p(!1),className:"font-semibold size-6"})]})}),e.jsxs("div",{className:"flex w-full h-[85%] flex-col py-4 gap-3",children:[e.jsx("span",{className:"text-xl",children:t==null?void 0:t.restaurantName}),e.jsxs("span",{className:"text-2xl",children:[(z=t==null?void 0:t.point)==null?void 0:z.toLocaleString("ko-KR")," 원"]}),e.jsx("span",{className:"text-xl",children:"결제를 승인하시겠습니까?"}),e.jsxs("div",{className:"flex w-full justify-center items-center gap-10 mt-4",children:[e.jsx("span",{onClick:()=>O(),className:"px-3 py-1 bg-blue text-white rounded-sm ",children:"승인"}),e.jsx("span",{onClick:()=>G(),className:"px-3 py-1 bg-red text-white rounded-sm ",children:"거절"})]})]})]})}):e.jsx("div",{})]})]})},Z=()=>{const[c,u]=r(U),[a,i]=r(B),[h,y]=r(q),[t,l]=r(E),[d,f]=r(P),[g,k]=r(A),w=sessionStorage.getItem("userId"),p=T();return j.useEffect(()=>{v({sessionId:w,accessToken:p,isLogin:g,setIsNotice:i,setIsPriceNotice:y,setIsOrderNotice:l})},[]),e.jsxs("div",{children:[e.jsx("div",{children:e.jsxs("div",{onClick:()=>f(!d),className:"absolute right-5 top-5 z-50 cursor-pointer",children:[a.length!==0&&e.jsx(D,{className:"absolute -right-0 -top-1 text-xs text-red animate-ping z-50"}),e.jsx(_,{className:`size-6 drop-shadow-xl ${c?"text-white":"text-black"}`})]})}),d&&e.jsx(Q,{})]})};export{Z as N};
