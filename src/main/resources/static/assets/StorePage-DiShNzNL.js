import{c as d,R as O,ar as _,j as e,p as m,q as S,w as $,a0 as R}from"./index-DE1blNUs.js";import{S as G}from"./SideBar-DY6hFi-z.js";import{u as M}from"./useModal-DPzFyzw8.js";import"./index-BOCF7S2W.js";import"./index-WfN3VHbb.js";const P=()=>{var y,b,v,k,I;const[h,w]=d.useState([]),[g,u]=d.useState([]),[f,j]=O(_),a=window.sessionStorage.getItem("restaurantId"),{Modal:t,open:c,close:x,eventData:s}=M({title:"주문 정보를 확인해주세요"});d.useEffect(()=>{(async()=>{const l={restaurantId:a};try{const n=(await m.get("/api/admin/restaurant/order/reservation",{params:l})).data.resultData;console.log("api 요청 성공 : ",n);const o=n.map(p=>p.orderDetails?p.orderDetails:[]);w([...n]),u([...o.flat()])}catch(i){console.log(i)}})()},[f]);const N=()=>j(r=>!r),L=async()=>{console.log(s);const r={orderId:s.orderId,reservationStatus:1};try{const l=await m.put("/api/admin/restaurant/order/reservation/status",r);console.log(l),l.data.resultData===1&&(S.fire({title:"주문을 승인했습니다!",text:"사용자 결제완료 후 테이블 목록에 추가됩니다",icon:"success"}),x(),N())}catch(l){console.log(l),S.fire({title:"에러 발생",text:"처리 중 문제가 발생했습니다. 다시 시도해주세요.",icon:"error"})}},C=async()=>{const r={orderId:s.orderId,reservationStatus:2};try{const l=await m.put("/api/order/access",r);console.log(l),x(),N()}catch(l){console.log(l)}};return e.jsx("div",{className:"flex flex-col w-2/5 h-dvh border-l-2 bg-white border-l-gray shadow-xl",children:e.jsxs("div",{className:"w-100% h-dvh",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex w-100% h-100% flex-col text-center pt-10 text-2xl mb-6 font-semibold",children:"새로운 주문"}),e.jsxs("div",{className:"flex w-full items-center justify-between px-6 py-2 border-b border-gray",children:[e.jsx("span",{className:"flex w-[30%] justify-center text-darkGray",children:"주문번호"}),e.jsx("span",{className:"flex w-[40%] justify-center text-darkGray",children:"메뉴"}),e.jsx("span",{className:"flex w-[30%] justify-center text-darkGray",children:"주문시간"})]})]}),e.jsx("ul",{className:"flex flex-col w-[100%] h-[100%] gap-4 pt-3 text-nowrap",children:h.map((r,l)=>{var i,n;return r.length===0?e.jsx("li",{className:"flex w-full items-center justify-between px-6 py-2",children:e.jsx("span",{children:"새로운 주문이 없습니다"})},r):e.jsxs("li",{onClick:()=>c(r),className:"flex w-full items-center justify-between px-6 py-2 border-b border-gray",children:[e.jsx("span",{className:"flex w-[30%] justify-center text-black",children:r.orderId}),e.jsx("span",{className:"flex flex-col w-[30%] justify-center text-black",children:r.orderDetails.map((o,p)=>e.jsx("div",{className:"truncate",children:o==null?void 0:o.menuName},p))}),e.jsx("span",{className:"flex w-[30%] justify-center text-black",children:(n=(i=r.orderDetails[0])==null?void 0:i.createdAt.split(" "))==null?void 0:n[1].slice(0,5)})]},l)})}),e.jsx(t,{children:e.jsxs("div",{className:"flex flex-col w-full h-full justify-between",children:[e.jsxs("div",{className:"flex flex-col w-full h-[60%] gap-4 pt-10 items-center",children:[e.jsxs("div",{className:"flex w-full px-10 gap-3",children:[e.jsx("span",{className:"flex w-[25%]",children:"주문번호"}),e.jsx("span",{className:"text-xl",children:s==null?void 0:s.orderId})]}),e.jsxs("div",{className:"flex w-full px-10 gap-3 items-center",children:[e.jsx("span",{className:"flex w-[25%]",children:"주문한 메뉴"}),e.jsx("span",{className:"text-xl",children:((b=(y=s==null?void 0:s.orderDetails)==null?void 0:y[0])==null?void 0:b.menuName)||"메뉴 정보 없음"})]}),e.jsxs("div",{className:"flex w-full px-10 gap-3 items-center",children:[e.jsx("span",{className:"flex w-[25%]",children:"주문한 사람"}),e.jsx("span",{className:"text-xl",children:s==null?void 0:s.userName})]}),e.jsxs("div",{className:"flex w-full px-10 gap-3 items-center",children:[e.jsx("span",{className:"flex w-[25%]",children:"핸드폰 번호"}),s.userPhone===null?e.jsx("span",{className:"text-darkGray",children:"등록된 번호가 없어요"}):e.jsx("span",{className:"text-xl",children:(I=(k=(v=s==null?void 0:s.userPhone)==null?void 0:v.replace(/[^0-9]/g,""))==null?void 0:k.replace(/^(\d{0,3})(\d{0,4})(\d{0,4})$/g,"$1-$2-$3"))==null?void 0:I.replace(/(-{1,2})$/g,"")})]}),e.jsxs("div",{className:"flex w-full h-[20%] px-10 gap-3 items-center",children:[e.jsx("span",{className:"flex w-[25%]",children:"인원 수"}),e.jsx("span",{className:"text-xl",children:(s==null?void 0:s.reservationPeopleCount)===0?"앉아서 주문":`${s==null?void 0:s.reservationPeopleCount}명`})]})]}),e.jsxs("div",{className:"flex w-full justify-center gap-10 mb-10",children:[e.jsx("div",{onClick:L,className:"bg-blue px-2 py-1 rounded-md text-nowrap text-white font-medium",children:"주문 승인"}),e.jsx("div",{onClick:C,className:"bg-red px-2 py-1 rounded-md text-nowrap text-white font-medium",children:"주문 취소"})]})]})})]})})},E=()=>{const[h,w]=d.useState(!0),[g,u]=d.useState([]),f=sessionStorage.getItem("restaurantId"),j=$();return d.useEffect(()=>{const a={restaurantId:f};(async()=>{try{const c=await m.get("/api/admin/restaurant/order",{params:a,headers:{Authorization:`Bearer ${j}`}});console.log(c.data.resultData);const x=c.data.resultData;u([...x])}catch(c){console.log(c)}})()},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full h-full bg-gray",children:e.jsx("div",{className:"w-100% h-[calc(100%_-_4rem)] mx-4 my-8 bg-white rounded-lg overflow-hidden overflow-y-scroll scrollbar-hide",children:e.jsx("div",{className:"flex flex-wrap ml-5 mt-5 gap-4 bg-white justify-start",children:g.map(a=>e.jsxs("div",{className:`${h?"w-[calc(33%_-_1rem)]":"w-[calc(25%_-_1rem)]"} min-w-40 h-48 border-2 border-darkGray bg-white cursor-pointer`,children:[e.jsxs("div",{className:" px-4 py-1 bg-third",children:[e.jsxs("div",{className:"flex justify-between items-center gap-3",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("span",{className:"text-sm text-nowrap",children:"주문번호"}),e.jsx("span",{className:"text-lg",children:a.orderId})]}),e.jsxs("span",{className:"font-semibold text-nowrap",children:[a==null?void 0:a.orderDetails.reduce((t,c)=>t+c.price,0).toLocaleString("ko-KR")," ","원"]})]}),e.jsxs("div",{className:"flex gap-2 tracking-wider items-center",children:[e.jsx("span",{className:"text-sm",children:"주문시간"}),e.jsxs("span",{className:"text-md",children:[R(a.reservationTime).format("HH:MM")," ~"]})]})]}),e.jsxs("div",{className:"px-3 py-3",children:[a.orderDetails.map((t,c)=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:t==null?void 0:t.menuName}),e.jsxs("span",{children:["x",t==null?void 0:t.menuCount]})]},c)),e.jsx("div",{className:"pt-1 pl-6 text-darkGray",children:a.menuInfo})]})]},a.orderId))})})}),e.jsx(P,{})]})},q=()=>e.jsxs("div",{className:"flex w-full h-dvh overflow-hidden scrollbar-hide justify-between",children:[e.jsx(G,{}),e.jsx(E,{})]});export{q as default};
