import{R as x,aF as C,aG as S,w as Q,c as n,u as A,ag as H,p as m,q as D,j as e,x as E,D as W}from"./index-CYoNUBdu.js";import{Q as z}from"./index-BDhFe9Cx.js";import{i as T,M}from"./MenuBar-BT6rhJdS.js";import{N as P}from"./NotificationIcon-DRnYemBw.js";import"./index-CSCgtsCb.js";import"./index-DR0ZvOQL.js";import"./index-BLJ-O3Sp.js";const X=()=>{var k,v,j;const[B,w]=x(T),[o,p]=x(C),[r,b]=x(S),f=Q(),y=sessionStorage.getItem("userId"),[h,q]=n.useState({couponW:0,visualH:0,infoH:0}),[F,N]=n.useState(0),[G,I]=n.useState(!1),$=A(),{id:c}=H(),l=n.useRef(null),d=n.useRef(null),L=()=>{const i=l.current,t=i.clientWidth,s=d.current,a=i.clientHeight,u=s.clientHeight;i.style.clipPath=`path('M0 0 L0 ${a-5} Q10 ${a-5} 10 ${a} L ${t-10} ${a} Q${t-10} ${a-5} ${t} ${a-5} L${t} 0 Z')`,s.style.clipPath=`path('M10 0 Q10 10 0 10 L0 ${u} L${t} ${u} L${t} 10 Q${t-10} 10 ${t-10} 0 Z')`};n.useLayoutEffect(()=>{w(!1),p(c),h.couponW>0&&(requestAnimationFrame(()=>{L()}),g())},[h]),n.useEffect(()=>{const i=()=>{if(!(!r||!r.restaurantName)&&l.current&&d.current){const s=l.current.clientWidth,a=l.current.clientHeight,u=d.current.clientHeight;l.current.style.clipPath=`path('M0 0 L0 ${a-5} Q10 ${a-5} 10 ${a} L ${s-10} ${a} Q${s-10} ${a-5} ${s} ${a-5} L${s} 0 Z')`,d.current.style.clipPath=`path('M10 0 Q10 10 0 10 L0 ${u} L${s} ${u} L${s} 10 Q${s-10} 10 ${s-10} 0 Z')`,I(!0)}};requestAnimationFrame(i);const t=()=>requestAnimationFrame(i);return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),n.useEffect(()=>{(!o||o<=0)&&(c?(console.log("URL id로 fetch 시도:",c),g(parseInt(c))):R())},[o,c]);const R=async()=>{const i={userId:y};try{const t=await m.get("/api/order/ticket/ticketOne",{params:i,headers:{Authorization:`Bearer ${f}`}});console.log("ticketId 응답:",t.data);const s=t.data.resultData;s?p(s):console.warn("티켓 ID가 없습니다.")}catch(t){console.error("티켓 ID 가져오기 실패:",t)}},g=async i=>{if(!i){console.warn("fetchTicketData 호출 실패 - ticketId 없음");return}try{const s=(await m.get("/api/order/ticket",{params:{ticketId:i},headers:{Authorization:`Bearer ${f}`}})).data.resultData.ticket;console.log("티켓 데이터:",s),b(s)}catch(t){console.error("티켓 데이터를 가져오는 중 오류 발생:",t),alert("티켓 정보를 가져오는 중 오류가 발생했습니다. 다시 시도해주세요.")}};return n.useEffect(()=>{if(!o)return;const i=setInterval(async()=>{try{const s=(await m.get("/api/order/ticket",{params:{ticketId:o},headers:{Authorization:`Bearer ${f}`}})).data.resultData.ticket;console.log("티켓 상태:",s.ticketStatus),s.ticketStatus===1&&(N(1),clearInterval(i),sessionStorage.removeItem("ticketId"),D.fire({title:"식권이 사용되었어요",icon:"success",confirmButtonText:"확인",allowOutsideClick:!1}).then(a=>{a.isConfirmed&&$("/user")}))}catch(t){console.error("티켓 상태 조회 실패:",t)}},3e3);return()=>clearInterval(i)},[o]),e.jsxs("div",{className:"flex flex-col w-full h-dvh px-5 py-20 overflow-x-hidden overflow-y-scroll scrollbar-hide",children:[e.jsx(P,{}),e.jsxs("div",{className:"absolute top-0 left-0 w-full flex justify-between items-center px-3 py-5 border-b-2 border-gray border-opacity-70 bg-white z-30",children:[e.jsx("span",{className:"flex w-[10%] justify-center text-2xl cursor-pointer",children:e.jsx(E,{onClick:()=>$("/user/order")})}),e.jsx("span",{className:"text-xl font-semibold tracking-wider",children:"내 식권"}),e.jsx("span",{children:" "})]}),e.jsx("section",{id:"visual",ref:l,className:"overflow-visible mt-2",children:e.jsxs("div",{className:"gap-4 pb-5 flex flex-col items-center justify-center bg-gray rounded-t-2xl border-b-2 border-dotted border-darkGray",children:[e.jsx("div",{className:"w-full text-center bg-primary rounded-t-2xl p-6 text-white font-bold",children:e.jsx("span",{className:"font-bold text-4xl text-nowrap",children:r.restaurantName})}),e.jsxs("div",{className:"flex flex-col w-full items-center",children:[e.jsx("span",{className:"text-base -ml-44 text-nowrap",children:"식권 발급 시간"}),e.jsxs("div",{className:"flex text-2xl text-center font-semibold gap-8",children:[e.jsx("span",{className:"flex tracking-widest",children:(k=r==null?void 0:r.reservationTime)==null?void 0:k.split(" ")[0]}),e.jsx("span",{className:"flex tracking-widest",children:(j=(v=r==null?void 0:r.reservationTime)==null?void 0:v.split(" ")[1])==null?void 0:j.slice(0,5)})]})]}),e.jsxs("div",{className:"flex flex-col w-full items-center gap-2",children:[e.jsxs("span",{className:"text-2xl",children:[r.menuNames,"외  ",r.menuNames.length-1,"개"]}),e.jsxs("span",{className:"text-4xl font-bold tracking-wider",children:[r.totalAmount.toLocaleString("ko-KR"),"원"]}),e.jsx("span",{className:"text-xl",children:r.personCount===0?"앉아서 주문":`${r.personCount}명 예약`})]})]})}),e.jsx("section",{id:"info",ref:d,children:e.jsx("div",{className:"p-10 flex flex-col justify-center items-center bg-gray rounded-b-2xl border-t-2 border-dotted border-darkGray",children:e.jsx("div",{className:"flex w-full justify-center items-center ",children:e.jsx(z,{value:`${W}/store/request?ticketId=${c}&restaurantId=${r.restaurantId}`,size:180,bgColor:"none"})})})}),e.jsx("div",{className:"text-xl underline text-center mt-10 pb-16",children:"예약 취소는 매장으로 문의해주세요"}),e.jsx(M,{})]})};export{X as default};
