import{u as T,R as I,a as z,E as G,c as n,j as e,V as O,az as P,b6 as _,av as H,Q as k,q as $,v as d}from"./index-QD4sUlUr.js";import{c as V}from"./index-2Luirxk7.js";import{M as W}from"./MenuBar-MEmgClIw.js";import{N as q}from"./NotificationIcon-B26ylE9l.js";import"./index-CW4i2JGu.js";import"./index-B5fVAYXV.js";function se(){const l=T(),[s,C]=I(z),[J,D]=I(G),[S,x]=n.useState(""),[R,f]=n.useState(""),[h,g]=n.useState(""),[i,U]=n.useState(null),[j,b]=n.useState(""),N=window.sessionStorage.getItem("userId");n.useEffect(()=>{if(s.nickName&&g(s.nickName),s.phone){const a=s.phone.replace(/^(\d{0,3})(\d{0,4})(\d{0,4})$/,"$1-$2-$3").replace(/(-{1,2})$/,"");x(a);const t=s.phone.replace(/[^0-9]/g,"").slice(0,11);f(t)}},[s.nickName,s.phone]),n.useEffect(()=>{D(!1),(async()=>{try{if(N){const t={userId:N},o=k(),r=(await $.get("/api/user",{params:t,headers:{Authorization:`Bearer ${o}`}})).data.resultData,v=r.point.toLocaleString("ko-KR");C({...r,point:v})}}catch(t){console.log(t)}})()},[]),n.useEffect(()=>{if(!i){b("");return}const a=URL.createObjectURL(i);return b(a),()=>URL.revokeObjectURL(a)},[i]);const E=async a=>{a.preventDefault();try{const t=k(),o={nickName:h||s.nickName,phone:R||s.phone},w=new Blob([JSON.stringify(o)],{type:"application/json"}),r=new FormData;if(r.append("req",w),i instanceof File)r.append("userPic",i);else if(s.userPic===null){const c=await(await fetch("/profile.jpeg")).blob(),m=c.type,u=new File([c],"default-pic.jpg",{type:m});r.append("userPic",u)}else{const y=`${P}/${s.userId}/${s.userPic}`;try{const c=await(await fetch(y)).blob(),m=c.type,u=new File([c],"prev-pic.jpg",{type:m});r.append("userPic",u)}catch(p){console.error("Failed to fetch previous image:",p)}}const v=await $.patch("/api/user/v3/userInfo",r,{headers:{Authorization:`Bearer ${t}`}});d.fire({icon:"success",title:"수정이 완료되었습니다.",showConfirmButton:!1,timer:1500}),l("/user/userInfo")}catch(t){console.error(t),d.fire("수정 실패","정보 수정에 실패하였습니다.","error")}},B=()=>{d.fire({icon:"warning",title:"수정이 취소되었습니다.",showConfirmButton:!1,timer:1500}).then(()=>{l("/user/userInfo")})},F=a=>{g(a.target.value)},A=a=>{const t=a.target.value.replace(/[^0-9]/g,"").slice(0,11),o=t.replace(/^(\d{0,3})(\d{0,4})(\d{0,4})$/,"$1-$2-$3").replace(/(-{1,2})$/,"");x(o),f(t)},L=a=>{const t=a.target.files[0];t&&U(t)},M=()=>{d.fire({icon:"warning",title:"수정이 취소되었습니다.",showConfirmButton:!1,timer:1500}).then(()=>{l("/user/userInfo")})};return e.jsxs("div",{className:"h-dvh overflow-x-hidden overflow-y-scroll scrollbar-hide bg-white",children:[e.jsx(q,{}),e.jsxs("div",{className:"absolute top-0 left-0 w-full flex justify-between items-center px-3 py-5 border-b-2 border-gray border-opacity-70 bg-white z-50",children:[e.jsx("span",{className:"flex w-[10%] justify-center text-2xl cursor-pointer",children:e.jsx(O,{onClick:M})}),e.jsx("span",{className:"text-xl font-semibold tracking-wider",children:"회원 정보 수정"}),e.jsx("span",{children:" "})]}),e.jsxs("div",{className:"flex flex-col h-dvh justify-around mt-24 gap-10",children:[e.jsxs("div",{className:"w-full h-[35%] flex flex-col items-center gap-4",children:[e.jsx("label",{htmlFor:"profile",children:e.jsxs("div",{className:"relative cursor-pointer",children:[e.jsx("img",{src:j||(s.userPic?`${P}/${s.userId}/${s.userPic}`:"/profile.jpeg"),alt:"프로필 이미지",className:"w-32 h-32 rounded-full object-cover border border-gray shadow-lg"}),e.jsx("div",{className:"absolute bottom-0 -right-1 text-xl bg-darkGray p-2 rounded-full border-4 border-white",children:e.jsx(V,{className:"text-white"})})]})}),e.jsx("input",{id:"profile",type:"file",className:"absolute left-[5000px] hidden",onChange:L}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"pr-3",children:"사용가능 포인트"}),e.jsx("span",{className:"font-bold text-2xl",children:s.point})]}),e.jsxs("span",{className:"flex items-center gap-2 px-3 py-1 border-2 border-gray rounded-xl",children:[e.jsx(_,{className:"text-xl"}),s.email]}),e.jsxs("div",{onClick:()=>l("/user/userInfo/myreview"),className:"flex items-center gap-1 cursor-pointer",children:[e.jsx("span",{className:"text-lg font-semibold",children:"내가 작성한 리뷰"}),e.jsx(H,{className:"text-xl font-semibold"})]})]}),e.jsx("div",{className:"h-[40%] flex justify-center items-center",children:e.jsxs("div",{className:"flex w-1/2 gap-5 items-center",children:[e.jsxs("div",{className:"flex flex-col w-[20%] gap-6 font-thin text-lg h-full text-darkGray text-nowrap",children:[e.jsx("span",{children:"닉네임"}),e.jsx("span",{children:"이름"}),e.jsx("span",{children:"아이디"}),e.jsx("span",{children:"소속"}),e.jsx("span",{children:"휴대폰"})]}),e.jsxs("div",{className:"flex flex-col w-[80%] gap-6 font-medium text-lg h-full text-nowrap",children:[e.jsx("div",{className:"flex items-center gap-2 cursor-pointer",children:e.jsx("input",{type:"text",onChange:F,className:"flex w-48 border rounded-md px-2",value:h,placeholder:"닉네임을 설정해주세요"})}),e.jsx("span",{children:s.name}),e.jsx("span",{children:s.uid}),e.jsx("span",{children:s.companyName}),e.jsx("div",{className:"flex items-center gap-2 cursor-pointer",children:e.jsx("input",{type:"tel",value:S,onChange:A,className:"flex w-48 border rounded-md px-2"})})]})]})}),e.jsxs("div",{className:"flex h-[20%] justify-center gap-5 mb-32",children:[e.jsx("div",{onClick:E,children:e.jsx("span",{className:"flex px-3 py-1 bg-primary rounded-lg text-white font-semibold text-center cursor-pointer",children:"수정 완료"})}),e.jsx("div",{onClick:B,children:e.jsx("span",{className:"flex px-3 py-1 bg-darkGray rounded-lg text-white font-semibold text-center cursor-pointer",children:"취소하기"})})]})]}),e.jsx(W,{})]})}export{se as default};
